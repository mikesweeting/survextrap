<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='This defines the CDF, cumulative hazard and hazard of a survival
distribution defined by combining the hazards of two different
groups (e.g. "treated" and "untreated") each defined by a standard
M-spline model. The log hazards of one group and the other are
interpolated over a defined period of time.  This may be used for
models where the treatment effect wanes, over a period of time,
between an estimated hazard ratio and zero.'><title>M-spline survival distribution under treatment effect waning — Survmspline_wane • survextrap</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="M-spline survival distribution under treatment effect waning — Survmspline_wane"><meta property="og:description" content='This defines the CDF, cumulative hazard and hazard of a survival
distribution defined by combining the hazards of two different
groups (e.g. "treated" and "untreated") each defined by a standard
M-spline model. The log hazards of one group and the other are
interpolated over a defined period of time.  This may be used for
models where the treatment effect wanes, over a period of time,
between an estimated hazard ratio and zero.'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">survextrap</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.15</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/cetuximab.html">Case study of using survextrap: cetuximab for head and neck cancer</a>
    <a class="dropdown-item" href="../articles/examples.html">Examples of using survextrap</a>
    <a class="dropdown-item" href="../articles/methods.html">Details of methods behind survextrap</a>
    <a class="dropdown-item" href="../articles/priors.html">Priors in survextrap models</a>
    <a class="dropdown-item" href="../articles/sbc.html">Simulation-based calibration of survextrap</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/chjackson/survextrap/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>M-spline survival distribution under treatment effect waning</h1>
      <small class="dont-index">Source: <a href="https://github.com/chjackson/survextrap/blob/HEAD/R/waning.R" class="external-link"><code>R/waning.R</code></a></small>
      <div class="d-none name"><code>Survmspline_wane.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This defines the CDF, cumulative hazard and hazard of a survival
distribution defined by combining the hazards of two different
groups (e.g. "treated" and "untreated") each defined by a standard
M-spline model. The log hazards of one group and the other are
interpolated over a defined period of time.  This may be used for
models where the treatment effect wanes, over a period of time,
between an estimated hazard ratio and zero.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">Hsurvmspline_wane</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">alpha1</span>,</span>
<span>  <span class="va">alpha0</span>,</span>
<span>  <span class="va">coefs1</span>,</span>
<span>  <span class="va">coefs0</span>,</span>
<span>  <span class="va">knots</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  <span class="va">wane_period</span>,</span>
<span>  wane_nt <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  pcure1 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  pcure0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  offsetH <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  backhaz <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bsmooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">psurvmspline_wane</span><span class="op">(</span></span>
<span>  <span class="va">q</span>,</span>
<span>  <span class="va">alpha1</span>,</span>
<span>  <span class="va">alpha0</span>,</span>
<span>  <span class="va">coefs1</span>,</span>
<span>  <span class="va">coefs0</span>,</span>
<span>  <span class="va">knots</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  bsmooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">wane_period</span>,</span>
<span>  wane_nt <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  lower.tail <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  pcure1 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  pcure0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  offsetH <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  backhaz <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  log.p <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">hsurvmspline_wane</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">alpha1</span>,</span>
<span>  <span class="va">alpha0</span>,</span>
<span>  <span class="va">coefs1</span>,</span>
<span>  <span class="va">coefs0</span>,</span>
<span>  <span class="va">knots</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  bsmooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">wane_period</span>,</span>
<span>  wane_nt <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  pcure1 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  pcure0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  offseth <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  backhaz <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dsurvmspline_wane</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">alpha1</span>,</span>
<span>  <span class="va">alpha0</span>,</span>
<span>  <span class="va">coefs1</span>,</span>
<span>  <span class="va">coefs0</span>,</span>
<span>  <span class="va">knots</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  bsmooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">wane_period</span>,</span>
<span>  wane_nt <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  pcure1 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  pcure0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  offseth <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  offsetH <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  backhaz <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">qsurvmspline_wane</span><span class="op">(</span></span>
<span>  <span class="va">p</span>,</span>
<span>  <span class="va">alpha1</span>,</span>
<span>  <span class="va">alpha0</span>,</span>
<span>  <span class="va">coefs1</span>,</span>
<span>  <span class="va">coefs0</span>,</span>
<span>  <span class="va">knots</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  bsmooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  lower.tail <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  log.p <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  pcure1 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  pcure0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  offsetH <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  backhaz <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">wane_period</span>,</span>
<span>  wane_nt <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">rsurvmspline_wane</span><span class="op">(</span></span>
<span>  <span class="va">n</span>,</span>
<span>  <span class="va">alpha1</span>,</span>
<span>  <span class="va">alpha0</span>,</span>
<span>  <span class="va">coefs1</span>,</span>
<span>  <span class="va">coefs0</span>,</span>
<span>  <span class="va">knots</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  bsmooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  pcure1 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  pcure0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  offsetH <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  backhaz <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">wane_period</span>,</span>
<span>  wane_nt <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">rmst_survmspline_wane</span><span class="op">(</span></span>
<span>  <span class="va">t</span>,</span>
<span>  <span class="va">alpha1</span>,</span>
<span>  <span class="va">alpha0</span>,</span>
<span>  <span class="va">coefs1</span>,</span>
<span>  <span class="va">coefs0</span>,</span>
<span>  <span class="va">knots</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  pcure1 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  pcure0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  offsetH <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  backhaz <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bsmooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">wane_period</span>,</span>
<span>  wane_nt <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  disc_rate <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mean_survmspline_wane</span><span class="op">(</span></span>
<span>  <span class="va">alpha1</span>,</span>
<span>  <span class="va">alpha0</span>,</span>
<span>  <span class="va">coefs1</span>,</span>
<span>  <span class="va">coefs0</span>,</span>
<span>  <span class="va">knots</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  pcure1 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  pcure0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  backhaz <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bsmooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">wane_period</span>,</span>
<span>  wane_nt <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  disc_rate <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x, q, t</dt>
<dd><p>Vector of times.</p></dd>


<dt>alpha1, coefs1, pcure1</dt>
<dd><p>log hazard intercept, spline coefficients and cure probability before the start of the waning period ("treated")</p></dd>


<dt>alpha0, coefs0, pcure0</dt>
<dd><p>log hazard intercept, spline coefficients and cure probability after the end of the waning period ("untreated")</p></dd>


<dt>knots</dt>
<dd><p>Locations of knots on the axis of time, supplied in
increasing order.  These include the two boundary knots.</p>
<p>In vectorised usage of these functions, the knots and degree must be
the same for all alternative times and parameter values.</p></dd>


<dt>degree</dt>
<dd><p>Spline polynomial degree.  Can only be changed from
the default of 3 if <code>bsmooth</code> is <code>FALSE</code>.</p></dd>


<dt>wane_period</dt>
<dd><p>vector of two components giving start and stop of waning
period</p></dd>


<dt>wane_nt</dt>
<dd><p>time resolution for piecewise constant hazard approximation in the
waning period.  If this is not specified, defaults to dividing the waning period into 10 pieces.</p></dd>


<dt>offsetH</dt>
<dd><p>Constant to be added to the cumulative hazard.</p></dd>


<dt>backhaz</dt>
<dd><p>A data frame that defines the background hazard as a piecewise-constant function of time.
This should have two columns, named <code>"time"</code> and
<code>"hazard"</code>. Each row gives the "background" hazard between the
specified time and the next time. The first element of
<code>"time"</code> should be 0, and the final row specifies the hazard at all
times greater than the last element of <code>"time"</code>.</p></dd>


<dt>bsmooth</dt>
<dd><p>If <code>TRUE</code> then the function is constrained to
also have zero derivative and second derivative at the boundary.</p></dd>


<dt>log, log.p</dt>
<dd><p>Return log density or probability.</p></dd>


<dt>lower.tail</dt>
<dd><p>logical; if <code>TRUE</code> (default), probabilities are \(P(X
\le x)\), otherwise, \(P(X &gt; x)\).</p></dd>


<dt>offseth</dt>
<dd><p>Constant to be added to the hazard, e.g. representing a "background" risk of death from causes other than the cause of interest.</p></dd>


<dt>p</dt>
<dd><p>Vector of probabilities.</p></dd>


<dt>n</dt>
<dd><p>Number of random numbers to simulate.</p></dd>


<dt>disc_rate</dt>
<dd><p>Discounting rate used to calculate the discounted mean or
restricted mean survival time, using an exponential discounting function.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p><code>psurvmspline_wane</code> gives the CDF, <code>Hsurvmspline_wane</code> gives the cumulative
hazard, <code>hsurvmspline_wane</code> gives the hazard, <code>dsurvmspline_wane</code> gives the PDF,
<code>qsurvmspline_wane</code> gives the quantiles, and <code>rsurvmspline_wane</code> generates random
numbers from the distribution.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This distribution is defined as follows.</p><ul><li><p>Between time 0 and <code>wane_period[1]</code>, the "treated" hazard is
used, as defined by an M-spline with intercept <code>alpha1</code>.</p></li>
<li><p>Between <code>wane_period[1]</code> and <code>wane_period[2]</code>, the log hazard is
defined by linear interpolation.  The waning period is divided
into a number of discrete pieces in which the hazard is assumed to
be constant, defined by the hazard at the start of the piece.
These hazard values are obtained from the spline model, using an
intercept parameter <code>alpha</code> (log scale parameter) defined by
linearly interpolating between <code>alpha1</code> and <code>alpha0</code> over the
waning period.  The cumulative hazard at any time can then be
deduced by adding up contributions on each piece.</p></li>
<li><p>After <code>wane_period[2]</code>, the "untreated" hazard is used, as defined by an
M-spline with intercept <code>alpha0</code>.</p></li>
</ul><p>See the <a href="https://chjackson.github.io/survextrap/articles/methods.html">methods vignette</a> for more details and examples.</p>
<p>This can be used to predict the hazard of a person treated with a
treatment whose short-term effect is estimated from shorter-term
data, but we wish to extrapolate this model over a longer period
where the effect is assumed to diminish.</p>
<p>This may not work if the hazard is zero or infinite at any point
in the waning period (thus the log hazard is indeterminate).  This
might typically happen at time 0.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christopher Jackson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

